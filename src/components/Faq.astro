---
type Props = {
  title: string;
  name: string;
};

const { title, name } = Astro.props as Props;
---

<div class="faq not-prose mt-3">
  <details name={name}>
    <summary
      class="flex items-center z-0 relative bg-casper-200 w-full py-2 px-4 rounded-lg text-casper-900 cursor-pointer"
    >
      <h3 class="flex-1">
        {title}
      </h3>
    </summary>
    <div class="py-3 px-2">
      <slot />
    </div>
  </details>
</div>
<style>
  @reference '../styles/global.css';

  .faq summary::marker,
  .faq summary::-webkit-details-marker {
    content: none;
    display: none;
  }

  .faq summary::before,
  .faq summary::after {
    content: "";
  }
  .faq summary::after {
    @apply content-['+'] transition-transform rotate-180 p-0 text-4xl origin-center;
  }
  .faq details[open] summary::after {
    @apply rotate-0 text-accent-600;
  }
  .faq details[open] summary h3 {
    @apply text-primary-900;
  }

  /* Fallback pour anciens navigateurs (grid hack) */
  .faq details > div {
    display: grid;
    grid-template-rows: 0fr;
    opacity: 0;
    transition:
      grid-template-rows 0.3s ease,
      opacity 0.3s ease;
  }

  .faq details > div > * {
    overflow: hidden;
  }

  .faq details[open] > div {
    grid-template-rows: 1fr;
    opacity: 1;
  }

  /* Animation moderne avec ::details-content (écrase le fallback si supporté) */
  @supports selector(::details-content) {
    .faq details > div {
      display: block;
      grid-template-rows: unset;
      opacity: 1;
      transition: none;
    }

    .faq details::details-content {
      opacity: 0;
      block-size: 0;
      overflow: hidden;
      transition:
        opacity 0.3s ease,
        block-size 0.3s ease,
        content-visibility 0.3s allow-discrete;
    }

    .faq details[open]::details-content {
      opacity: 1;
      block-size: auto;
    }
  }

  /* Active l'interpolation vers "auto" */
  @supports (interpolate-size: allow-keywords) {
    .faq details {
      interpolate-size: allow-keywords;
    }
  }
</style>
<script>
  document.querySelectorAll(".faq details summary").forEach((dt) => {
    dt.addEventListener("click", () => {
      dt.querySelector("span")?.classList.toggle("rotate-45");
    });
  });
</script>
